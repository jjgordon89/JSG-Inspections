"use strict";(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[934],{1841:()=>{},3553:(e,a,t)=>{t.r(a),t.d(a,{default:()=>u});var n=t(5043),r=(t(1841),t(8970));function i(e){return async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{maxRetries:t=3,baseDelay:n=1e3,maxDelay:r=1e4,shouldRetry:i=e=>{var a;return!0===(null===e||void 0===e||null===(a=e.error)||void 0===a?void 0:a.retryable)}}=a;let o;for(let u=0;u<=t;u++)try{var s,l;const a=await e();if(null!==(s=window.api)&&void 0!==s&&s.isError(a)&&!i(a))return a;if(null===(l=window.api)||void 0===l||!l.isError(a))return a;if(o=a,u===t)break;const c=Math.min(n*Math.pow(2,u),r);console.log(`Retrying operation in ${c}ms (attempt ${u+1}/${t+1})`),await new Promise(e=>setTimeout(e,c))}catch(c){if(o=c,u===t||!i(c))break;const e=Math.min(n*Math.pow(2,u),r);console.log(`Retrying operation in ${e}ms (attempt ${u+1}/${t+1})`),await new Promise(a=>setTimeout(a,e))}return o}(e,{maxRetries:3,baseDelay:500,maxDelay:5e3,shouldRetry:e=>{var a;if(null!==(a=window.api)&&void 0!==a&&a.isError(e)){var t,n;const a=null===(t=e.error)||void 0===t?void 0:t.code;return["SQLITE_BUSY","SQLITE_LOCKED","NETWORK_ERROR","TIMEOUT"].includes(a)||!0===(null===(n=e.error)||void 0===n?void 0:n.retryable)}return!1},...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}})}async function o(e,a){try{var t;const a=await e();if((null===(t=window.api)||void 0===t||!t.isError(a))&&a.data)return console.log("Operation already completed, skipping write"),a}catch(n){console.log("Check operation failed, proceeding with write:",n)}return await a()}var s=t(8221),l=t(579);const c={equipmentId:"",type:"Overhead Crane",manufacturer:"",model:"",serialNumber:"",capacity:"",installationDate:"",location:"",status:"active",files:[],qrCodeData:""};const u=function(e){let{onEquipmentAdded:a}=e;const[t,u]=(0,n.useState)(c),d=(0,s.A)(e=>e.showToast),p=e=>{const{name:a,value:t}=e.target;u(e=>({...e,[a]:t}))};return(0,l.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const n=await async function(e,a,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{successMessage:r,retryable:o=!1,onSuccess:s,onError:l}=n;try{var c;let n;if(n=o?await i(e):await e(),null!==(c=window.api)&&void 0!==c&&c.isError(n)){const e=window.api.getErrorMessage(n);return console.error(`${t} failed:`,n.error),a&&a(`${t} failed: ${e}`,"error"),l&&l(n),n}return r&&a&&a(r,"success"),s&&s(n),n}catch(u){throw console.error(`${t} failed with exception:`,u),a&&a(`${t} failed: ${u.message}`,"error"),l&&l(u),u}}(async()=>{const{files:e,...a}=t,n=(await window.api.equipment.create({equipmentId:a.equipmentId,type:a.type,manufacturer:a.manufacturer,model:a.model,serialNumber:a.serialNumber,capacity:a.capacity,installationDate:a.installationDate,location:a.location,status:a.status,qrCodeData:a.qrCodeData})).lastID,r=[];for(const t of e){const e=async()=>await window.api.documents.checkExisting(n,t.name),a=async()=>await window.api.documents.create({equipmentId:n,fileName:t.name,filePath:t.path||t.name,hash:"placeholder",size:t.size||0}),i=await o(e,a);r.push(i)}return{success:!0,data:{equipmentId:n,documentsAdded:r.length}}},d,"Add Equipment",{successMessage:`Equipment "${t.equipmentId}" added successfully`,onSuccess:()=>{a(),u(c)},onError:e=>{var t;null!==(t=e.error)&&void 0!==t&&t.partialSuccess&&(a(),u(c))}});return n},className:"add-equipment-form",children:[(0,l.jsx)("h3",{children:"Add New Equipment"}),(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsx)("input",{name:"equipmentId",value:t.equipmentId,onChange:p,placeholder:"Equipment ID",required:!0}),(0,l.jsxs)("select",{name:"type",value:t.type,onChange:p,children:[(0,l.jsx)("option",{children:"Overhead Crane"}),(0,l.jsx)("option",{children:"Gantry Crane"}),(0,l.jsx)("option",{children:"Jib"}),(0,l.jsx)("option",{children:"Monorail"}),(0,l.jsx)("option",{children:"Hoist"})]}),(0,l.jsx)("input",{name:"manufacturer",value:t.manufacturer,onChange:p,placeholder:"Manufacturer"}),(0,l.jsx)("input",{name:"model",value:t.model,onChange:p,placeholder:"Model"}),(0,l.jsx)("input",{name:"serialNumber",value:t.serialNumber,onChange:p,placeholder:"Serial Number"}),(0,l.jsx)("input",{name:"capacity",type:"number",value:t.capacity,onChange:p,placeholder:"Capacity"}),(0,l.jsx)("input",{name:"installationDate",type:"date",value:t.installationDate,onChange:p}),(0,l.jsx)("input",{name:"location",value:t.location,onChange:p,placeholder:"Location"}),(0,l.jsxs)("select",{name:"status",value:t.status,onChange:p,children:[(0,l.jsx)("option",{value:"active",children:"Active"}),(0,l.jsx)("option",{value:"out of service",children:"Out of Service"}),(0,l.jsx)("option",{value:"under maintenance",children:"Under Maintenance"})]}),(0,l.jsx)("input",{type:"file",multiple:!0,onChange:e=>{u(a=>({...a,files:e.target.files}))},className:"form-full-width"}),(0,l.jsxs)("div",{className:"form-buttons",children:[(0,l.jsx)("button",{type:"button",onClick:async()=>{if(!t.equipmentId)return void alert("Please enter an Equipment ID first.");const e=await(async e=>{try{return await r.toDataURL(e,{errorCorrectionLevel:"H",type:"image/jpeg",quality:.3,margin:1,color:{dark:"#010599FF",light:"#FFBF60FF"}})}catch(a){return console.error(a),null}})(t.equipmentId);u(a=>({...a,qrCodeData:e}))},className:"btn-secondary",children:"Associate QR/NFC Tag"}),(0,l.jsx)("button",{type:"submit",className:"btn-submit",children:"Add Equipment"})]}),t.qrCodeData&&(0,l.jsx)("div",{className:"qr-code-container",children:(0,l.jsx)("img",{src:t.qrCodeData,alt:"QR Code"})})]})]})}}}]);
//# sourceMappingURL=934.aecc1572.chunk.js.map