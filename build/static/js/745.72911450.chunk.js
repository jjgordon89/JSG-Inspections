"use strict";(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[745],{6745:(e,s,a)=>{a.r(s),a.d(s,{default:()=>i});var l=a(5043),t=a(4107),n=a(579);const i=()=>{const{currentUser:e}=(0,t.J)(),[s,a]=(0,l.useState)([]),[i,r]=(0,l.useState)([]),[d,c]=(0,l.useState)([]),[u,o]=(0,l.useState)(!0),[m,p]=(0,l.useState)(null),[h,x]=(0,l.useState)("schedules"),[v,j]=(0,l.useState)(!1),[y,N]=(0,l.useState)(!1),[g,f]=(0,l.useState)({name:"",equipmentType:"",description:"",frequencyType:"calendar",frequencyValue:"",frequencyUnit:"days",estimatedDuration:"",instructions:"",requiredSkills:"",requiredParts:"",safetyNotes:""}),[b,q]=(0,l.useState)({equipmentId:"",pmTemplateId:"",nextDueDate:"",nextDueUsage:""});(0,l.useEffect)(()=>{w()},[]);const w=async()=>{try{o(!0),p(null);const[e,s]=await Promise.all([window.api.pmTemplates.getAll(),window.api.equipment.getAll()]);a(e),c(s);const l=s.map(e=>window.api.pmSchedules.getByEquipmentId(e.id)),t=(await Promise.all(l)).flat();r(t)}catch(e){console.error("Error loading PM data:",e),p(e.message)}finally{o(!1)}},_=e=>{const{frequency_type:s,frequency_value:a,frequency_unit:l}=e;return"calendar"===s||"usage"===s?`Every ${a} ${l}`:`Condition-based (${a} ${l})`},D=e=>{if(!e)return"no-date";const s=new Date,a=new Date(e)-s,l=Math.ceil(a/864e5);return l<0?"overdue":l<=7?"due-soon":l<=30?"upcoming":"current"},C=e=>{const s={overdue:{class:"due-overdue",label:"Overdue"},"due-soon":{class:"due-soon",label:"Due Soon"},upcoming:{class:"due-upcoming",label:"Upcoming"},current:{class:"due-current",label:"Current"},"no-date":{class:"due-no-date",label:"No Date"}}[D(e)];return(0,n.jsx)("span",{className:`due-badge ${s.class}`,children:s.label})};return u?(0,n.jsxs)("div",{className:"preventive-maintenance",children:[(0,n.jsx)("div",{className:"pm-header",children:(0,n.jsx)("h1",{children:"Preventive Maintenance"})}),(0,n.jsx)("div",{className:"loading-spinner",children:"Loading PM data..."})]}):m?(0,n.jsxs)("div",{className:"preventive-maintenance",children:[(0,n.jsx)("div",{className:"pm-header",children:(0,n.jsx)("h1",{children:"Preventive Maintenance"})}),(0,n.jsxs)("div",{className:"error-message",children:[(0,n.jsxs)("p",{children:["Error loading PM data: ",m]}),(0,n.jsx)("button",{onClick:w,className:"retry-button",children:"Retry"})]})]}):(0,n.jsxs)("div",{className:"preventive-maintenance",children:[(0,n.jsxs)("div",{className:"pm-header",children:[(0,n.jsx)("h1",{children:"Preventive Maintenance"}),(0,n.jsxs)("div",{className:"header-actions",children:[(0,n.jsxs)("div",{className:"tab-selector",children:[(0,n.jsxs)("button",{className:"tab-button "+("schedules"===h?"active":""),onClick:()=>x("schedules"),children:["\ud83d\udcc5 Schedules (",i.length,")"]}),(0,n.jsxs)("button",{className:"tab-button "+("templates"===h?"active":""),onClick:()=>x("templates"),children:["\ud83d\udccb Templates (",s.length,")"]})]}),(0,n.jsxs)("div",{className:"action-buttons",children:["schedules"===h&&(0,n.jsx)("button",{className:"create-button",onClick:()=>N(!0),children:"+ Schedule PM"}),"templates"===h&&(0,n.jsx)("button",{className:"create-button",onClick:()=>j(!0),children:"+ Create Template"})]})]})]}),"schedules"===h&&(0,n.jsxs)("div",{className:"pm-schedules",children:[(0,n.jsxs)("div",{className:"pm-summary",children:[(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value",children:i.length}),(0,n.jsx)("span",{className:"summary-label",children:"Total Schedules"})]}),(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value status-warning",children:i.filter(e=>"due-soon"===D(e.next_due_date)).length}),(0,n.jsx)("span",{className:"summary-label",children:"Due Soon"})]}),(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value status-critical",children:i.filter(e=>"overdue"===D(e.next_due_date)).length}),(0,n.jsx)("span",{className:"summary-label",children:"Overdue"})]}),(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value status-good",children:i.filter(e=>"current"===D(e.next_due_date)).length}),(0,n.jsx)("span",{className:"summary-label",children:"Current"})]})]}),(0,n.jsx)("div",{className:"schedules-list",children:0===i.length?(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("p",{children:"No PM schedules configured."}),(0,n.jsx)("button",{className:"create-button",onClick:()=>N(!0),children:"Create First Schedule"})]}):i.map(a=>{const l=d.find(e=>e.id===a.equipment_id);return(0,n.jsxs)("div",{className:"schedule-card",children:[(0,n.jsxs)("div",{className:"schedule-header",children:[(0,n.jsxs)("div",{className:"schedule-title",children:[(0,n.jsx)("h3",{children:a.template_name}),(0,n.jsxs)("span",{className:"schedule-equipment",children:[null===l||void 0===l?void 0:l.equipment_id," - ",null===l||void 0===l?void 0:l.type]})]}),(0,n.jsxs)("div",{className:"schedule-badges",children:[C(a.next_due_date),(0,n.jsx)("span",{className:"frequency-badge",children:_(a)})]})]}),(0,n.jsxs)("div",{className:"schedule-details",children:[(0,n.jsxs)("div",{className:"detail-row",children:[(0,n.jsx)("span",{className:"detail-label",children:"Next Due:"}),(0,n.jsx)("span",{className:"detail-value",children:a.next_due_date?new Date(a.next_due_date).toLocaleDateString():"Not scheduled"})]}),a.last_completed_date&&(0,n.jsxs)("div",{className:"detail-row",children:[(0,n.jsx)("span",{className:"detail-label",children:"Last Completed:"}),(0,n.jsx)("span",{className:"detail-value",children:new Date(a.last_completed_date).toLocaleDateString()})]}),a.next_due_usage&&(0,n.jsxs)("div",{className:"detail-row",children:[(0,n.jsx)("span",{className:"detail-label",children:"Usage Due:"}),(0,n.jsxs)("span",{className:"detail-value",children:[a.next_due_usage," ",a.frequency_unit]})]})]}),(0,n.jsxs)("div",{className:"schedule-actions",children:[(0,n.jsx)("button",{className:"action-button generate-wo",onClick:()=>(async a=>{try{const l=d.find(e=>e.id===a.equipment_id),t=s.find(e=>e.id===a.pm_template_id);if(!l||!t)return void p("Equipment or template not found");const n=`PM-${l.equipment_id}-${(new Date).getFullYear()}-${String(Date.now()).slice(-4)}`,i={equipmentId:a.equipment_id,woNumber:n,title:`${t.name} - ${l.equipment_id}`,description:t.description||`Preventive maintenance for ${l.equipment_id}`,workType:"preventive",priority:"overdue"===D(a.next_due_date)?"high":"medium",assignedTo:null,estimatedHours:t.estimated_duration||null,createdBy:(null===e||void 0===e?void 0:e.full_name)||"Unknown User",scheduledDate:a.next_due_date,deficiencyId:null,pmScheduleId:a.id},r=await window.api.workOrders.create(i),c=(null===r||void 0===r?void 0:r.lastID)||(null===r||void 0===r?void 0:r.id)||0;await window.api.auditLog.create({userId:(null===e||void 0===e?void 0:e.id)||null,username:(null===e||void 0===e?void 0:e.username)||"Unknown User",action:"create",entityType:"work_order",entityId:c,oldValues:null,newValues:JSON.stringify(i),ipAddress:null,userAgent:navigator.userAgent}),alert(`Work Order ${n} created successfully!`),await w()}catch(l){console.error("Error generating work order:",l),p(l.message)}})(a),children:"Generate Work Order"}),(0,n.jsx)("button",{className:"action-button view-history",children:"View History"})]})]},a.id)})})]}),"templates"===h&&(0,n.jsxs)("div",{className:"pm-templates",children:[(0,n.jsxs)("div",{className:"templates-summary",children:[(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value",children:s.length}),(0,n.jsx)("span",{className:"summary-label",children:"Total Templates"})]}),(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value status-good",children:s.filter(e=>"calendar"===e.frequency_type).length}),(0,n.jsx)("span",{className:"summary-label",children:"Calendar-Based"})]}),(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value status-warning",children:s.filter(e=>"usage"===e.frequency_type).length}),(0,n.jsx)("span",{className:"summary-label",children:"Usage-Based"})]}),(0,n.jsxs)("div",{className:"summary-card",children:[(0,n.jsx)("span",{className:"summary-value status-info",children:s.filter(e=>"condition"===e.frequency_type).length}),(0,n.jsx)("span",{className:"summary-label",children:"Condition-Based"})]})]}),(0,n.jsx)("div",{className:"templates-list",children:0===s.length?(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("p",{children:"No PM templates created."}),(0,n.jsx)("button",{className:"create-button",onClick:()=>j(!0),children:"Create First Template"})]}):s.map(e=>(0,n.jsxs)("div",{className:"template-card",children:[(0,n.jsxs)("div",{className:"template-header",children:[(0,n.jsxs)("div",{className:"template-title",children:[(0,n.jsx)("h3",{children:e.name}),(0,n.jsx)("span",{className:"template-equipment-type",children:e.equipment_type})]}),(0,n.jsxs)("div",{className:"template-badges",children:[(0,n.jsx)("span",{className:`frequency-type-badge ${e.frequency_type}`,children:e.frequency_type}),(0,n.jsx)("span",{className:"frequency-badge",children:_(e)})]})]}),e.description&&(0,n.jsx)("div",{className:"template-description",children:(0,n.jsx)("p",{children:e.description})}),(0,n.jsxs)("div",{className:"template-details",children:[e.estimated_duration&&(0,n.jsxs)("div",{className:"detail-row",children:[(0,n.jsx)("span",{className:"detail-label",children:"Estimated Duration:"}),(0,n.jsxs)("span",{className:"detail-value",children:[e.estimated_duration," hours"]})]}),e.required_skills&&(0,n.jsxs)("div",{className:"detail-row",children:[(0,n.jsx)("span",{className:"detail-label",children:"Required Skills:"}),(0,n.jsx)("span",{className:"detail-value",children:JSON.parse(e.required_skills).join(", ")})]}),e.required_parts&&(0,n.jsxs)("div",{className:"detail-row",children:[(0,n.jsx)("span",{className:"detail-label",children:"Required Parts:"}),(0,n.jsx)("span",{className:"detail-value",children:JSON.parse(e.required_parts).join(", ")})]})]}),e.instructions&&(0,n.jsxs)("div",{className:"template-instructions",children:[(0,n.jsx)("h4",{children:"Instructions:"}),(0,n.jsx)("p",{children:e.instructions})]}),e.safety_notes&&(0,n.jsxs)("div",{className:"template-safety",children:[(0,n.jsx)("h4",{children:"\u26a0\ufe0f Safety Notes:"}),(0,n.jsx)("p",{children:e.safety_notes})]}),(0,n.jsxs)("div",{className:"template-actions",children:[(0,n.jsx)("button",{className:"action-button edit",children:"Edit Template"}),(0,n.jsx)("button",{className:"action-button create-schedule",children:"Create Schedule"}),(0,n.jsx)("button",{className:"action-button deactivate",children:"Deactivate"})]})]},e.id))})]}),v&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content large",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:"Create PM Template"}),(0,n.jsx)("button",{className:"close-button",onClick:()=>j(!1),children:"\xd7"})]}),(0,n.jsxs)("form",{onSubmit:async s=>{s.preventDefault();try{const s=await window.api.pmTemplates.create({name:g.name,equipmentType:g.equipmentType,description:g.description,frequencyType:g.frequencyType,frequencyValue:parseInt(g.frequencyValue),frequencyUnit:g.frequencyUnit,estimatedDuration:g.estimatedDuration?parseFloat(g.estimatedDuration):null,instructions:g.instructions,requiredSkills:g.requiredSkills?JSON.stringify(g.requiredSkills.split(",").map(e=>e.trim())):null,requiredParts:g.requiredParts?JSON.stringify(g.requiredParts.split(",").map(e=>e.trim())):null,safetyNotes:g.safetyNotes}),a=(null===s||void 0===s?void 0:s.lastID)||(null===s||void 0===s?void 0:s.id)||0;await window.api.auditLog.create({userId:(null===e||void 0===e?void 0:e.id)||null,username:(null===e||void 0===e?void 0:e.username)||"Unknown User",action:"create",entityType:"pm_template",entityId:a,oldValues:null,newValues:JSON.stringify(g),ipAddress:null,userAgent:navigator.userAgent}),j(!1),f({name:"",equipmentType:"",description:"",frequencyType:"calendar",frequencyValue:"",frequencyUnit:"days",estimatedDuration:"",instructions:"",requiredSkills:"",requiredParts:"",safetyNotes:""}),await w()}catch(a){console.error("Error creating PM template:",a),p(a.message)}},className:"create-form",children:[(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Template Name *"}),(0,n.jsx)("input",{type:"text",value:g.name,onChange:e=>f({...g,name:e.target.value}),required:!0,placeholder:"e.g., Monthly Crane Inspection"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Equipment Type *"}),(0,n.jsxs)("select",{value:g.equipmentType,onChange:e=>f({...g,equipmentType:e.target.value}),required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select Equipment Type"}),[...new Set(d.map(e=>e.type).filter(Boolean))].map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Description"}),(0,n.jsx)("textarea",{value:g.description,onChange:e=>f({...g,description:e.target.value}),rows:"3",placeholder:"Brief description of the maintenance procedure"})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Frequency Type *"}),(0,n.jsxs)("select",{value:g.frequencyType,onChange:e=>f({...g,frequencyType:e.target.value}),required:!0,children:[(0,n.jsx)("option",{value:"calendar",children:"Calendar-Based"}),(0,n.jsx)("option",{value:"usage",children:"Usage-Based"}),(0,n.jsx)("option",{value:"condition",children:"Condition-Based"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Frequency Value *"}),(0,n.jsx)("input",{type:"number",min:"1",value:g.frequencyValue,onChange:e=>f({...g,frequencyValue:e.target.value}),required:!0,placeholder:"e.g., 30"})]})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Frequency Unit"}),(0,n.jsxs)("select",{value:g.frequencyUnit,onChange:e=>f({...g,frequencyUnit:e.target.value}),children:[(0,n.jsx)("option",{value:"days",children:"Days"}),(0,n.jsx)("option",{value:"weeks",children:"Weeks"}),(0,n.jsx)("option",{value:"months",children:"Months"}),(0,n.jsx)("option",{value:"hours",children:"Hours"}),(0,n.jsx)("option",{value:"cycles",children:"Cycles"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Estimated Duration (hours)"}),(0,n.jsx)("input",{type:"number",step:"0.5",min:"0",value:g.estimatedDuration,onChange:e=>f({...g,estimatedDuration:e.target.value}),placeholder:"e.g., 2.5"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Instructions"}),(0,n.jsx)("textarea",{value:g.instructions,onChange:e=>f({...g,instructions:e.target.value}),rows:"4",placeholder:"Detailed step-by-step maintenance instructions"})]}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Required Skills (comma-separated)"}),(0,n.jsx)("input",{type:"text",value:g.requiredSkills,onChange:e=>f({...g,requiredSkills:e.target.value}),placeholder:"e.g., Electrical, Hydraulics, Rigging"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Required Parts (comma-separated)"}),(0,n.jsx)("input",{type:"text",value:g.requiredParts,onChange:e=>f({...g,requiredParts:e.target.value}),placeholder:"e.g., Oil filter, Hydraulic fluid, Grease"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Safety Notes"}),(0,n.jsx)("textarea",{value:g.safetyNotes,onChange:e=>f({...g,safetyNotes:e.target.value}),rows:"3",placeholder:"Important safety considerations and precautions"})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"button",onClick:()=>j(!1),className:"cancel-button",children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"submit-button",children:"Create Template"})]})]})]})}),y&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:"Create PM Schedule"}),(0,n.jsx)("button",{className:"close-button",onClick:()=>N(!1),children:"\xd7"})]}),(0,n.jsxs)("form",{onSubmit:async s=>{s.preventDefault();try{const s=await window.api.pmSchedules.create({equipmentId:parseInt(b.equipmentId),pmTemplateId:parseInt(b.pmTemplateId),nextDueDate:b.nextDueDate,nextDueUsage:b.nextDueUsage?parseFloat(b.nextDueUsage):null}),a=(null===s||void 0===s?void 0:s.lastID)||(null===s||void 0===s?void 0:s.id)||0;await window.api.auditLog.create({userId:(null===e||void 0===e?void 0:e.id)||null,username:(null===e||void 0===e?void 0:e.username)||"Unknown User",action:"create",entityType:"pm_schedule",entityId:a,oldValues:null,newValues:JSON.stringify(b),ipAddress:null,userAgent:navigator.userAgent}),N(!1),q({equipmentId:"",pmTemplateId:"",nextDueDate:"",nextDueUsage:""}),await w()}catch(a){console.error("Error creating PM schedule:",a),p(a.message)}},className:"create-form",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Equipment *"}),(0,n.jsxs)("select",{value:b.equipmentId,onChange:e=>q({...b,equipmentId:e.target.value}),required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select Equipment"}),d.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.equipment_id," - ",e.type]},e.id))]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"PM Template *"}),(0,n.jsxs)("select",{value:b.pmTemplateId,onChange:e=>q({...b,pmTemplateId:e.target.value}),required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select PM Template"}),s.filter(e=>{if(!b.equipmentId)return!0;const s=d.find(e=>e.id===parseInt(b.equipmentId));return s&&e.equipment_type===s.type}).map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name," (",_(e),")"]},e.id))]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Next Due Date *"}),(0,n.jsx)("input",{type:"date",value:b.nextDueDate,onChange:e=>q({...b,nextDueDate:e.target.value}),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Next Due Usage (if usage-based)"}),(0,n.jsx)("input",{type:"number",step:"0.1",min:"0",value:b.nextDueUsage,onChange:e=>q({...b,nextDueUsage:e.target.value}),placeholder:"e.g., 1000 (hours/cycles)"})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"button",onClick:()=>N(!1),className:"cancel-button",children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"submit-button",children:"Create Schedule"})]})]})]})})]})}}}]);
//# sourceMappingURL=745.72911450.chunk.js.map