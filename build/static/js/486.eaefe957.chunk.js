/*! For license information please see 486.eaefe957.chunk.js.LICENSE.txt */
(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[486,688],{486:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>D});var i=n(5043),o=n(4157),r=n(4688);function s(){return s=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},s.apply(null,arguments)}var a=n(816);function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(0,a.A)(i.key),i)}}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(d=function(){return!!t})()}var u=n(2284);function p(t,e){if(e&&("object"==(0,u.A)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}var f=n(5173);function m(t,e,n){this.x=t,this.y=e,this.time=n||(new Date).getTime()}function v(t,e,n,i){this.startPoint=t,this.control1=e,this.control2=n,this.endPoint=i}function g(t,e){var n=this,i=e||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.throttle="throttle"in i?i.throttle:16,this.minDistance="minDistance"in i?i.minDistance:5,this.throttle?this._strokeMoveUpdate=function(t,e,n){var i,o,r,s=null,a=0;n||(n={});var c=function(){a=!1===n.leading?0:Date.now(),s=null,r=t.apply(i,o),s||(i=o=null)};return function(){var l=Date.now();a||!1!==n.leading||(a=l);var h=e-(l-a);return i=this,o=arguments,h<=0||h>e?(s&&(clearTimeout(s),s=null),a=l,r=t.apply(i,o),s||(i=o=null)):s||!1===n.trailing||(s=setTimeout(c,h)),r}}(g.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=g.prototype._strokeUpdate,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this.onBegin=i.onBegin,this.onEnd=i.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(n._mouseButtonDown=!0,n._strokeBegin(t))},this._handleMouseMove=function(t){n._mouseButtonDown&&n._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(t))},this._handleTouchStart=function(t){if(1===t.targetTouches.length){var e=t.changedTouches[0];n._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];n._strokeMoveUpdate(e)},this._handleTouchEnd=function(t){t.target===n._canvas&&(t.preventDefault(),n._strokeEnd(t))},this.on()}m.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},m.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},m.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},v.prototype.length=function(){for(var t=0,e=void 0,n=void 0,i=0;i<=10;i+=1){var o=i/10,r=this._point(o,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(o,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(i>0){var a=r-e,c=s-n;t+=Math.sqrt(a*a+c*c)}e=r,n=s}return t},v.prototype._point=function(t,e,n,i,o){return e*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*i*(1-t)*t*t+o*t*t*t},g.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0},g.prototype.fromDataURL=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new Image,o=n.ratio||window.devicePixelRatio||1,r=n.width||this._canvas.width/o,s=n.height||this._canvas.height/o;this._reset(),i.src=t,i.onload=function(){e._ctx.drawImage(i,0,0,r,s)},this._isEmpty=!1},g.prototype.toDataURL=function(t){var e;if("image/svg+xml"===t)return this._toSVG();for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(e=this._canvas).toDataURL.apply(e,[t].concat(i))},g.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},g.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},g.prototype.isEmpty=function(){return this._isEmpty},g.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"===typeof this.onBegin&&this.onBegin(t)},g.prototype._strokeUpdate=function(t){var e=t.clientX,n=t.clientY,i=this._createPoint(e,n),o=this._data[this._data.length-1],r=o&&o[o.length-1],s=r&&i.distanceTo(r)<this.minDistance;if(!r||!s){var a=this._addPoint(i),c=a.curve,l=a.widths;c&&l&&this._drawCurve(c,l.start,l.end),this._data[this._data.length-1].push({x:i.x,y:i.y,time:i.time,color:this.penColor})}},g.prototype._strokeEnd=function(t){var e=this.points.length>2,n=this.points[0];if(!e&&n&&this._drawDot(n),n){var i=this._data[this._data.length-1],o=i[i.length-1];n.equals(o)||i.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}"function"===typeof this.onEnd&&this.onEnd(t)},g.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},g.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},g.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},g.prototype._createPoint=function(t,e,n){var i=this._canvas.getBoundingClientRect();return new m(t-i.left,e-i.top,n||(new Date).getTime())},g.prototype._addPoint=function(t){var e=this.points;if(e.push(t),e.length>2){3===e.length&&e.unshift(e[0]);var n=this._calculateCurveControlPoints(e[0],e[1],e[2]).c2,i=this._calculateCurveControlPoints(e[1],e[2],e[3]).c1,o=new v(e[1],n,i,e[2]),r=this._calculateCurveWidths(o);return e.shift(),{curve:o,widths:r}}return{}},g.prototype._calculateCurveControlPoints=function(t,e,n){var i=t.x-e.x,o=t.y-e.y,r=e.x-n.x,s=e.y-n.y,a=(t.x+e.x)/2,c=(t.y+e.y)/2,l=(e.x+n.x)/2,h=(e.y+n.y)/2,d=Math.sqrt(i*i+o*o),u=Math.sqrt(r*r+s*s),p=u/(d+u),f=l+(a-l)*p,v=h+(c-h)*p,g=e.x-f,x=e.y-v;return{c1:new m(a+g,c+x),c2:new m(l+g,h+x)}},g.prototype._calculateCurveWidths=function(t){var e=t.startPoint,n=t.endPoint,i={start:null,end:null},o=this.velocityFilterWeight*n.velocityFrom(e)+(1-this.velocityFilterWeight)*this._lastVelocity,r=this._strokeWidth(o);return i.start=this._lastWidth,i.end=r,this._lastVelocity=o,this._lastWidth=r,i},g.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},g.prototype._drawPoint=function(t,e,n){var i=this._ctx;i.moveTo(t,e),i.arc(t,e,n,0,2*Math.PI,!1),this._isEmpty=!1},g.prototype._drawCurve=function(t,e,n){var i=this._ctx,o=n-e,r=Math.floor(t.length());i.beginPath();for(var s=0;s<r;s+=1){var a=s/r,c=a*a,l=c*a,h=1-a,d=h*h,u=d*h,p=u*t.startPoint.x;p+=3*d*a*t.control1.x,p+=3*h*c*t.control2.x,p+=l*t.endPoint.x;var f=u*t.startPoint.y;f+=3*d*a*t.control1.y,f+=3*h*c*t.control2.y,f+=l*t.endPoint.y;var m=e+l*o;this._drawPoint(p,f,m)}i.closePath(),i.fill()},g.prototype._drawDot=function(t){var e=this._ctx,n="function"===typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,n),e.closePath(),e.fill()},g.prototype._fromData=function(t,e,n){for(var i=0;i<t.length;i+=1){var o=t[i];if(o.length>1)for(var r=0;r<o.length;r+=1){var s=o[r],a=new m(s.x,s.y,s.time),c=s.color;if(0===r)this.penColor=c,this._reset(),this._addPoint(a);else if(r!==o.length-1){var l=this._addPoint(a),h=l.curve,d=l.widths;h&&d&&e(h,d,c)}}else this._reset(),n(o[0])}},g.prototype._toSVG=function(){var t=this,e=this._data,n=this._canvas,i=Math.max(window.devicePixelRatio||1,1),o=n.width/i,r=n.height/i,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttributeNS(null,"width",n.width),s.setAttributeNS(null,"height",n.height),this._fromData(e,function(t,e,n){var i=document.createElement("path");if(!isNaN(t.control1.x)&&!isNaN(t.control1.y)&&!isNaN(t.control2.x)&&!isNaN(t.control2.y)){var o="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" "+t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" "+t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3);i.setAttribute("d",o),i.setAttribute("stroke-width",(2.25*e.end).toFixed(3)),i.setAttribute("stroke",n),i.setAttribute("fill","none"),i.setAttribute("stroke-linecap","round"),s.appendChild(i)}},function(e){var n=document.createElement("circle"),i="function"===typeof t.dotSize?t.dotSize():t.dotSize;n.setAttribute("r",i),n.setAttribute("cx",e.x),n.setAttribute("cy",e.y),n.setAttribute("fill",e.color),s.appendChild(n)});var a='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+o+" "+r+'" width="'+o+'" height="'+r+'">',c=s.innerHTML;if(void 0===c){var l=document.createElement("dummy"),h=s.childNodes;l.innerHTML="";for(var d=0;d<h.length;d+=1)l.appendChild(h[d].cloneNode(!0));c=l.innerHTML}return"data:image/svg+xml;base64,"+btoa(a+c+"</svg>")},g.prototype.fromData=function(t){var e=this;this.clear(),this._fromData(t,function(t,n){return e._drawCurve(t,n.start,n.end)},function(t){return e._drawDot(t)}),this._data=t},g.prototype.toData=function(){return this._data};const x=g;var y=n(2576),_=["canvasProps","clearOnResize"],w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(a,t);var e,n,o,r=function(t){var e=d();return function(){var n,i=h(t);if(e){var o=h(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return p(this,n)}}(a);function a(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).staticThis=t.constructor,t._sigPad=null,t._canvas=null,t.setRef=function(e){t._canvas=e,null===t._canvas&&(t._sigPad=null)},t._excludeOurProps=function(){var e=t.props;return e.canvasProps,e.clearOnResize,function(t,e){if(null==t)return{};var n,i,o=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(-1!==e.indexOf(i))continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)n=r[i],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(e,_)},t.componentDidMount=function(){var e=t.getCanvas();t._sigPad=new x(e,t._excludeOurProps()),t._resizeCanvas(),t.on()},t.componentWillUnmount=function(){t.off()},t.componentDidUpdate=function(){Object.assign(t._sigPad,t._excludeOurProps())},t.getCanvas=function(){if(null===t._canvas)throw t.staticThis.refNullError;return t._canvas},t.getTrimmedCanvas=function(){var e=t.getCanvas(),n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),y(n)},t.getSignaturePad=function(){if(null===t._sigPad)throw t.staticThis.refNullError;return t._sigPad},t._checkClearOnResize=function(){t.props.clearOnResize&&t._resizeCanvas()},t._resizeCanvas=function(){var e,n,i=null!==(e=t.props.canvasProps)&&void 0!==e?e:{},o=i.width,r=i.height;if("undefined"===typeof o||"undefined"===typeof r){var s=t.getCanvas(),a=Math.max(null!==(n=window.devicePixelRatio)&&void 0!==n?n:1,1);"undefined"===typeof o&&(s.width=s.offsetWidth*a),"undefined"===typeof r&&(s.height=s.offsetHeight*a),s.getContext("2d").scale(a,a),t.clear()}},t.render=function(){var e=t.props.canvasProps;return i.createElement("canvas",s({ref:t.setRef},e))},t.on=function(){return window.addEventListener("resize",t._checkClearOnResize),t.getSignaturePad().on()},t.off=function(){return window.removeEventListener("resize",t._checkClearOnResize),t.getSignaturePad().off()},t.clear=function(){return t.getSignaturePad().clear()},t.isEmpty=function(){return t.getSignaturePad().isEmpty()},t.fromDataURL=function(e,n){return t.getSignaturePad().fromDataURL(e,n)},t.toDataURL=function(e,n){return t.getSignaturePad().toDataURL(e,n)},t.fromData=function(e){return t.getSignaturePad().fromData(e)},t.toData=function(){return t.getSignaturePad().toData()},t}return e=a,n&&c(e.prototype,n),o&&c(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}(i.Component);w.propTypes={velocityFilterWeight:f.number,minWidth:f.number,maxWidth:f.number,minDistance:f.number,dotSize:f.oneOfType([f.number,f.func]),penColor:f.string,throttle:f.number,onEnd:f.func,onBegin:f.func,canvasProps:f.object,clearOnResize:f.bool},w.defaultProps={clearOnResize:!0},w.refNullError=new Error("react-signature-canvas is currently mounting or unmounting: React refs are null during this phase.");var b=n(3953),j=n(579);const C=function(t){let{checklist:e,onDone:n,equipment:o,scheduledInspectionId:r=null}=t;const[s,a]=(0,i.useState)(""),[c,l]=(0,i.useState)(""),[h,d]=(0,i.useState)(!0),u=(0,i.useRef)({});i.useEffect(()=>{(async()=>{if(r)try{const t=(await window.api.secureOperation("scheduledInspections","getAll")).find(t=>t.id===r);t&&t.assigned_inspector&&l(t.assigned_inspector)}catch(t){console.error("Error fetching scheduled inspection for prefill:",t)}c||l("Inspector Name"),d(!1)})()},[r]);const p=e.flatMap(t=>t.items).filter(t=>"fail"===t.result),f=p.reduce((t,e)=>(t[e.priority]=(t[e.priority]||0)+1,t),{});return h?(0,j.jsx)("div",{className:"summary-container",children:"Loading inspection details..."}):(0,j.jsxs)("div",{className:"summary-container",children:[(0,j.jsxs)("div",{className:"report-header",children:[(0,j.jsx)("h2",{children:"Inspection Report"}),(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Equipment:"})," ",o.equipment_id," - ",o.type]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Date:"})," ",(new Date).toLocaleDateString()]}),(0,j.jsxs)("div",{className:"inspector-field",children:[(0,j.jsx)("label",{children:(0,j.jsx)("strong",{children:"Inspector:"})}),(0,j.jsx)("input",{type:"text",value:c,onChange:t=>l(t.target.value),placeholder:"Enter inspector name",style:{marginLeft:"8px",padding:"4px 8px",border:"1px solid #ccc",borderRadius:"4px"}})]}),r&&(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Scheduled Inspection ID:"})," ",r]})]}),(0,j.jsxs)("div",{className:"at-a-glance",children:[(0,j.jsx)("h3",{children:"At a Glance"}),(0,j.jsxs)("p",{children:["Total Deficiencies: ",p.length]}),(0,j.jsx)("ul",{children:Object.entries(f).map(t=>{let[e,n]=t;return(0,j.jsxs)("li",{children:[(0,j.jsxs)("strong",{children:[e,":"]})," ",n]},e)})})]}),(0,j.jsxs)("div",{className:"deficiencies-list",children:[(0,j.jsx)("h3",{children:"Deficiency Details"}),p.length>0?p.map((t,e)=>(0,j.jsxs)("div",{className:"deficiency-item",children:[(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Item:"})," ",t.text]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Component:"})," ",t.component]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Priority:"})," ",t.priority]}),(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Notes:"})," ",t.notes]}),(0,j.jsx)("div",{className:"photo-gallery",children:t.photos.map((t,e)=>(0,j.jsx)("img",{src:t.dataUrl,alt:`Deficiency photo ${e+1}`},e))})]},e)):(0,j.jsx)("p",{children:"No deficiencies found."})]}),(0,j.jsxs)("div",{className:"summary-comments",children:[(0,j.jsx)("h3",{children:"Summary Comments"}),(0,j.jsx)("textarea",{value:s,onChange:t=>a(t.target.value),placeholder:"Add overall summary comments here..."})]}),(0,j.jsxs)("div",{className:"signature-section",children:[(0,j.jsx)("h3",{children:"Inspector Signature"}),(0,j.jsx)(w,{ref:u,penColor:"black",canvasProps:{className:"sig-canvas"}}),(0,j.jsx)("button",{onClick:()=>u.current.clear(),children:"Clear"})]}),(0,j.jsxs)("div",{className:"summary-actions",children:[(0,j.jsx)("button",{className:"export-btn",onClick:()=>{const t=u.current.getTrimmedCanvas().toDataURL("image/png"),n={equipment_id:o.id,inspector:"Inspector Name",inspection_date:(new Date).toISOString(),findings:JSON.stringify(e),summary_comments:s,signature:t};(0,b.M6)(n)},type:"button",children:"Export PDF"}),(0,j.jsx)("button",{className:"done-btn",onClick:async()=>{try{const t=u.current.getTrimmedCanvas().toDataURL("image/png"),i=(new Date).toISOString(),a={equipmentId:o.id,inspector:c,inspectionDate:i,findings:JSON.stringify(e),correctiveActions:"",summaryComments:s,signature:t,scheduledInspectionId:r},l=r?"createFromScheduled":"create",h=(await window.api.secureOperation("inspections",l,a)).lastID;for(const n of e)for(const t of n.items){const e={inspectionId:h,standardRef:t.standardRef||null,itemText:t.text,critical:t.critical||!1,result:t.result,notes:t.notes||"",photos:JSON.stringify(t.photos||[]),component:t.component||"",priority:t.priority||"Minor"},n=await window.api.secureOperation("inspectionItems","create",e);if("fail"===t.result){const e={equipmentId:o.id,inspectionItemId:n.lastID,severity:t.priority.toLowerCase(),removeFromService:"Critical"===t.priority,description:t.notes||`Failed inspection item: ${t.text}`,component:t.component||"",correctiveAction:"",dueDate:null,status:"open"};await window.api.secureOperation("deficiencies","create",e)}}r&&await window.api.secureOperation("scheduledInspections","updateStatus",{id:r,status:"completed"}),n(!0)}catch(t){console.error("Error finalizing inspection:",t),n(!1)}},children:"Finalize & Save Report"})]})]})};const P=function(t){let{item:e,itemIndex:n,sectionTitle:i,onUpdateItem:o,onPhotoClick:r}=t;const s=(t,e)=>{o(i,n,{[t]:e})};return(0,j.jsxs)("div",{className:"inspection-item",children:[(0,j.jsx)("span",{className:"item-text",children:e.text}),(0,j.jsx)("div",{className:"item-controls",children:["Pass","Fail","N/A"].map(t=>(0,j.jsx)("button",{type:"button",className:`result-btn ${t.toLowerCase()} ${e.result===t.toLowerCase()?"selected":""}`,onClick:()=>(t=>{o(i,n,{result:t.toLowerCase()})})(t),children:t},t))}),"fail"===e.result&&(0,j.jsxs)("div",{className:"deficiency-details",children:[(0,j.jsxs)("div",{className:"deficiency-field",children:[(0,j.jsx)("label",{children:"Priority:"}),(0,j.jsxs)("select",{value:e.priority,onChange:t=>s("priority",t.target.value),children:[(0,j.jsx)("option",{value:"Critical",children:"Critical"}),(0,j.jsx)("option",{value:"Major",children:"Major"}),(0,j.jsx)("option",{value:"Minor",children:"Minor"})]})]}),(0,j.jsxs)("div",{className:"deficiency-field",children:[(0,j.jsx)("label",{children:"Component:"}),(0,j.jsx)("input",{type:"text",value:e.component,onChange:t=>s("component",t.target.value),placeholder:"Affected component"})]}),(0,j.jsxs)("div",{className:"deficiency-field",children:[(0,j.jsx)("label",{children:"Notes:"}),(0,j.jsx)("textarea",{value:e.notes,onChange:t=>s("notes",t.target.value),placeholder:"Detailed description of deficiency",rows:"3"})]}),(0,j.jsxs)("div",{className:"deficiency-field",children:[(0,j.jsx)("label",{children:"Photos:"}),(0,j.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:t=>{const r=Array.from(t.target.files).map(t=>new Promise(e=>{const n=new FileReader;n.onload=n=>e({file:t,dataUrl:n.target.result,annotations:[]}),n.readAsDataURL(t)}));Promise.all(r).then(t=>{const r=[...e.photos,...t];o(i,n,{photos:r})})}}),e.photos&&e.photos.length>0&&(0,j.jsx)("div",{className:"photo-thumbnails",children:e.photos.map((t,s)=>(0,j.jsxs)("div",{className:"photo-thumbnail",children:[(0,j.jsx)("img",{src:t.dataUrl,alt:`Deficiency ${s+1}`,onClick:()=>r(i,n,s,t)}),(0,j.jsx)("button",{type:"button",onClick:()=>(t=>{const r=e.photos.filter((e,n)=>n!==t);o(i,n,{photos:r})})(s),className:"remove-photo",children:"\xd7"})]},s))})]})]})]})};const k=function(t){let{section:e,isOpen:n,onToggle:i,onUpdateItem:o,onPhotoClick:r}=t;const{title:s,items:a}=e;return(0,j.jsxs)("div",{className:"inspection-section",children:[(0,j.jsxs)("h3",{className:"section-title "+(n?"open":""),onClick:i,children:[(0,j.jsx)("span",{className:"section-title-text",children:s}),(0,j.jsx)("span",{className:"section-toggle-icon",children:n?"\u25bc":"\u25b6"})]}),n&&(0,j.jsx)("div",{className:"section-content",children:a.map((t,e)=>(0,j.jsx)(P,{item:t,itemIndex:e,sectionTitle:s,onUpdateItem:o,onPhotoClick:r},t.id))})]})},S={"Overhead Crane":{Structure:[{id:"oc-s-1",text:"Inspect main girders for damage or corrosion"},{id:"oc-s-2",text:"Check end trucks for wear and tear"}],"Hoisting System":[{id:"oc-h-1",text:"Inspect hoist brake for proper function"},{id:"oc-h-2",text:"Check wire rope for kinks or breaks"}],Trolley:[{id:"oc-t-1",text:"Inspect trolley wheels for wear"},{id:"oc-t-2",text:"Check trolley frame for cracks"}],Electrics:[{id:"oc-e-1",text:"Inspect pendant for proper operation"},{id:"oc-e-2",text:"Check wiring for frays or damage"}],"Safety Features":[{id:"oc-sf-1",text:"Verify limit switches are functional"},{id:"oc-sf-2",text:"Check warning horn and lights"}]},"Gantry Crane":{Structure:[{id:"gc-s-1",text:"Inspect legs and end beams for damage"},{id:"gc-s-2",text:"Check runway for alignment and wear"}],"Hoisting System":[{id:"gc-h-1",text:"Inspect hoist brake for proper function"},{id:"gc-h-2",text:"Check wire rope for kinks or breaks"}]},Jib:{Structure:[{id:"j-s-1",text:"Inspect mast and boom for damage"},{id:"j-s-2",text:"Check foundation for cracks or movement"}],Rotation:[{id:"j-r-1",text:"Check rotation stops and bearings"}]},Monorail:{Track:[{id:"m-t-1",text:"Inspect monorail track for wear and alignment"},{id:"m-t-2",text:"Check track splices and hangers"}],Trolley:[{id:"m-tr-1",text:"Inspect trolley wheels and frame"}]},Hoist:{"Hoisting System":[{id:"h-h-1",text:"Inspect hoist brake for proper function"},{id:"h-h-2",text:"Check chain or wire rope condition"},{id:"h-h-3",text:"Inspect hook and latch"}]}};let N={};try{N=n(591)}catch(O){console.log("No custom templates file found, using default checklists only"),N={}}var E=n(7690);const D=function(t){let{onInspectionAdded:e,onCancel:n,showToast:s}=t;const a=(0,E.r9)(t=>t.inspectingEquipment),c=(0,E.bc)(t=>t.addingInspectionFor),l=a||("object"===typeof c?c:{id:c,type:""}),[h,d]=(0,i.useState)([]),[u,p]=(0,i.useState)(!1),[f,m]=(0,i.useState)(null),[v,g]=(0,i.useState)(null),[x,y]=(0,i.useState)(null);(0,i.useEffect)(()=>{const t=(e=l.type,N[e]?N[e]:S[e]||{});var e;const n=Object.keys(t).map((e,n)=>({title:e,items:t[e].map(t=>({...t,result:null,photos:[],notes:"",priority:"Minor",component:""}))}));d(n),n.length>0&&y(n[0].title)},[l.type]);const _=(t,e,n)=>{const i=h.map(i=>{if(i.title===t){const t=[...i.items];return t[e]={...t[e],...n},{...i,items:t}}return i});d(i)},w=(t,e,n,i)=>{g({sectionTitle:t,itemIndex:e,photoIndex:n}),m(i)};return u?(0,j.jsx)(C,{checklist:h,onDone:t=>{t&&e&&e(),n()},equipment:l}):(0,j.jsxs)("form",{onSubmit:t=>{t.preventDefault();try{p(!0),s&&s("Inspection form completed successfully","success")}catch(O){console.error("Error submitting inspection:",O),s&&s("Failed to submit inspection. Please try again.","error")}},className:"inspection-form",children:[h.map(t=>(0,j.jsx)(k,{section:t,isOpen:x===t.title,onToggle:()=>y(x===t.title?null:t.title),onUpdateItem:_,onPhotoClick:w},t.title)),(0,j.jsxs)("div",{className:"form-actions",children:[(0,j.jsx)("button",{type:"button",onClick:n,children:"Cancel"}),(0,j.jsx)("button",{type:"submit",children:"Review & Submit"})]}),f&&(0,j.jsx)(o.A,{onClose:()=>m(null),children:(0,j.jsx)(r.default,{photo:f,onSave:t=>{if(v){const{sectionTitle:e,itemIndex:n,photoIndex:i}=v,o=h.map(o=>{if(o.title===e){const e=[...o.items],r=[...e[n].photos];return r[i]=t,e[n]={...e[n],photos:r},{...o,items:e}}return o});d(o)}m(null),g(null)},onCancel:()=>m(null)})})]})}},591:t=>{"use strict";t.exports=JSON.parse('{"templates":[],"version":"1.0.0","lastUpdated":"2024-01-01T00:00:00.000Z"}')},816:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});var i=n(2284);function o(t){var e=function(t,e){if("object"!=(0,i.A)(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=(0,i.A)(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==(0,i.A)(e)?e:e+""}},1497:(t,e,n)=>{"use strict";var i=n(3218);function o(){}function r(){}r.resetWarningCache=o,t.exports=function(){function t(t,e,n,o,r,s){if(s!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function e(){return t}t.isRequired=t;var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:r,resetWarningCache:o};return n.PropTypes=n,n}},2576:function(t){t.exports=function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";function n(t){var e=t.getContext("2d"),n=t.width,i=t.height,o=e.getImageData(0,0,n,i).data,a=r(!0,n,i,o),c=r(!1,n,i,o),l=s(!0,n,i,o),h=s(!1,n,i,o)-l+1,d=c-a+1,u=e.getImageData(l,a,h,d);return t.width=h,t.height=d,e.clearRect(0,0,h,d),e.putImageData(u,0,0),t}function i(t,e,n,i){return{red:i[4*(n*e+t)],green:i[4*(n*e+t)+1],blue:i[4*(n*e+t)+2],alpha:i[4*(n*e+t)+3]}}function o(t,e,n,o){return i(t,e,n,o).alpha}function r(t,e,n,i){for(var r=t?1:-1,s=t?0:n-1;t?s<n:s>-1;s+=r)for(var a=0;a<e;a++)if(o(a,s,e,i))return s;return null}function s(t,e,n,i){for(var r=t?1:-1,s=t?0:e-1;t?s<e:s>-1;s+=r)for(var a=0;a<n;a++)if(o(s,a,e,i))return s;return null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n}])},3218:t=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4688:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var i=n(5043),o=n(2877),r=n(579);const s=function(t){let{photo:e,onSave:n,onCancel:s,enableBatchMode:a=!1,batchPhotos:c=[]}=t;const l=(0,i.useRef)(null),h=(0,i.useRef)(null),[d,u]=(0,i.useState)("#FF0000"),[p,f]=(0,i.useState)(.8),[m,v]=(0,i.useState)(0),[g,x]=(0,i.useState)({}),[y,_]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(l.current&&!y){const t=new o.eF(l.current,{targetRoot:document.body,markerTypes:[o.yA,o.MX,o.nY]});e.annotations&&e.annotations.length>0&&t.restoreState(e.annotations),t.addEventListener("render",t=>{const i={...e,dataUrl:t.dataUrl,annotations:t.state};n(i)}),t.addEventListener("close",()=>{s&&s()}),_(!0),t.show(),h.current=t}return()=>{h.current&&(h.current.close(),h.current=null,_(!1))}},[e,n,s,y]);const w=()=>{h.current&&h.current.close(),s&&s()},b=a&&c.length>0?c[m]:e,j="string"===typeof b?b:null===b||void 0===b?void 0:b.dataUrl;return(0,r.jsxs)("div",{className:"photo-annotation-container",children:[(0,r.jsxs)("div",{className:"annotation-toolbar",children:[(0,r.jsxs)("div",{className:"toolbar-section",children:[(0,r.jsx)("label",{children:"Annotation Color:"}),(0,r.jsx)("input",{type:"color",value:d,onChange:t=>{return e=t.target.value,u(e),void(h.current&&h.current.setMarkerColor(e));var e}})]}),(0,r.jsxs)("div",{className:"toolbar-section",children:[(0,r.jsx)("label",{children:"Compression Quality:"}),(0,r.jsx)("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:p,onChange:t=>f(parseFloat(t.target.value))}),(0,r.jsxs)("span",{children:[Math.round(100*p),"%"]}),(0,r.jsx)("button",{onClick:async()=>{const t="string"===typeof e?e:e.dataUrl;if(t)try{const e=await fetch(t),i=await e.blob(),o=await function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1920,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1080;return new Promise(o=>{const r=document.createElement("canvas"),s=r.getContext("2d"),a=new Image;a.onload=()=>{let{width:t,height:c}=a;if(t>n||c>i){const e=Math.min(n/t,i/c);t*=e,c*=e}r.width=t,r.height=c,s.drawImage(a,0,0,t,c),r.toBlob(o,"image/jpeg",e)},a.src=URL.createObjectURL(t)})}(i,p),r=new FileReader;r.onload=()=>{const t=r.result;n&&n({dataUrl:t,compressed:!0,originalSize:i.size,compressedSize:o.size,compressionRatio:(1-o.size/i.size).toFixed(2)})},r.readAsDataURL(o)}catch(i){console.error("Compression failed:",i)}},className:"compress-btn",children:"Compress Photo"})]}),a&&c.length>0&&(0,r.jsxs)("div",{className:"toolbar-section batch-controls",children:[(0,r.jsxs)("span",{children:["Photo ",m+1," of ",c.length]}),(0,r.jsx)("button",{onClick:()=>{m>0&&v(t=>t-1)},disabled:0===m,className:"nav-btn",children:"Previous"}),(0,r.jsx)("button",{onClick:()=>{m<c.length-1&&v(t=>t+1)},disabled:m===c.length-1,className:"nav-btn",children:"Next"})]}),(0,r.jsx)("div",{className:"annotation-actions",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:async()=>{if(a&&c.length>0){const t=c[m];if(h.current&&t){const t=await new Promise(t=>{h.current.addEventListener("render",e=>{t({dataUrl:e.dataUrl,annotations:h.current.getState()})},{once:!0}),h.current.render()});x(e=>({...e,[m]:t})),m<c.length-1?v(t=>t+1):n&&n(g)}}},className:"save-btn",children:m===c.length-1?"Finish Batch":"Save & Next"}),(0,r.jsx)("button",{onClick:w,className:"cancel-btn",children:"Cancel Batch"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:async()=>{h.current&&h.current.render()},className:"save-btn",children:"Save Annotations"}),(0,r.jsx)("button",{onClick:w,className:"cancel-btn",children:"Cancel"})]})})]}),(0,r.jsx)("img",{ref:l,src:j,alt:"For annotation",style:{maxWidth:"100%",maxHeight:"70vh"}})]})}},5173:(t,e,n)=>{t.exports=n(1497)()}}]);
//# sourceMappingURL=486.eaefe957.chunk.js.map