"use strict";(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[16],{7016:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(5043),s=a(579);const i=function(){const[e,t]=(0,n.useState)([]),[a,i]=(0,n.useState)([]),[d,l]=(0,n.useState)(""),[r,c]=(0,n.useState)(""),[o,u]=(0,n.useState)([]),[p,h]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[j,g]=(0,n.useState)(""),[w,y]=(0,n.useState)([]),[S,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{C(),f()},[]);const C=async()=>{const e=await window.api.compliance.getAllStandards();t(e)},f=async()=>{const e=await window.api.equipment.getDistinctTypes();i(e.map(e=>e.type))};(0,n.useEffect)(()=>{r?b(r):u([])},[r]);const b=async e=>{const t=await window.api.compliance.getAssignedStandards(e);u(t)};return(0,s.jsxs)("div",{className:"compliance-manager",children:[(0,s.jsx)("h2",{children:"Compliance Management"}),(0,s.jsxs)("div",{className:"standards-list",children:[(0,s.jsx)("h3",{children:"Existing Standards"}),(0,s.jsx)("ul",{children:e.map(e=>(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:e.name})," (",e.authority,"): ",e.description,(0,s.jsx)("button",{onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this standard? This will also remove all assignments.")&&(await window.api.compliance.deleteStandard(e),C())})(e.id),className:"delete-button",children:"Delete"})]},e.id))})]}),(0,s.jsxs)("div",{className:"add-standard-form",children:[(0,s.jsx)("h3",{children:"Add New Standard"}),(0,s.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p?(await window.api.compliance.createStandard({name:p,description:m,authority:j}),C(),h(""),x(""),g("")):alert("Please enter a standard name.")},children:[(0,s.jsx)("input",{type:"text",placeholder:"Standard Name (e.g., OSHA 1910.179)",value:p,onChange:e=>h(e.target.value),required:!0}),(0,s.jsx)("textarea",{placeholder:"Description",value:m,onChange:e=>x(e.target.value)}),(0,s.jsx)("input",{type:"text",placeholder:"Authority (e.g., OSHA)",value:j,onChange:e=>g(e.target.value)}),(0,s.jsx)("button",{type:"submit",children:"Add Standard"})]})]}),(0,s.jsxs)("div",{className:"assign-standard-form",children:[(0,s.jsx)("h3",{children:"Assign Standard to Equipment Type"}),(0,s.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),r&&d?(await window.api.compliance.assignStandard(r,d),b(r),alert("Standard assigned successfully.")):alert("Please select an equipment type and a standard.")},children:[(0,s.jsxs)("select",{value:r,onChange:e=>c(e.target.value),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Equipment Type"}),a.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsxs)("select",{value:d,onChange:e=>l(e.target.value),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select Standard"}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsx)("button",{type:"submit",children:"Assign Standard"})]}),r&&(0,s.jsxs)("div",{className:"assigned-standards-list",children:[(0,s.jsxs)("h4",{children:["Assigned to ",r]}),(0,s.jsx)("ul",{children:o.map(e=>(0,s.jsxs)("li",{children:[e.name,(0,s.jsx)("button",{onClick:()=>(async e=>{r&&(await window.api.compliance.unassignStandard(r,e),b(r))})(e.id),className:"delete-button",children:"Remove"})]},e.id))})]})]}),(0,s.jsxs)("div",{className:"compliance-status-checker",children:[(0,s.jsx)("h3",{children:"Equipment Compliance Status"}),(0,s.jsx)("button",{onClick:async()=>{v(!0);const e=await window.api.equipment.getAll(),t=await window.api.compliance.getComplianceReport(),a=(await window.api.inspections.getLastInspectionByEquipment()).reduce((e,t)=>(e[t.equipment_id]=t.last_inspection_date,e),{}),n=t.reduce((e,t)=>(e[t.equipment_type]||(e[t.equipment_type]=[]),e[t.equipment_type].push(t.standard_name),e),{}),s=e.map(e=>{if(0===(n[e.type]||[]).length)return{...e,status:"N/A",reason:"No standards assigned to type"};const t=a[e.id];if(!t)return{...e,status:"Non-Compliant",reason:"No inspection history"};const s=new Date;s.setFullYear(s.getFullYear()-1);return new Date(t)<s?{...e,status:"Non-Compliant",reason:`Last inspection on ${t} (over 1 year ago)`}:{...e,status:"Compliant",reason:`Last inspection on ${t}`}});y(s),v(!1)},disabled:S,children:S?"Calculating...":"Calculate Compliance Status"}),w.length>0&&(0,s.jsxs)("table",{children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Equipment ID"}),(0,s.jsx)("th",{children:"Type"}),(0,s.jsx)("th",{children:"Status"}),(0,s.jsx)("th",{children:"Reason"})]})}),(0,s.jsx)("tbody",{children:w.map(e=>(0,s.jsxs)("tr",{className:`status-${e.status.toLowerCase().replace(" ","-")}`,children:[(0,s.jsx)("td",{children:e.equipment_id}),(0,s.jsx)("td",{children:e.type}),(0,s.jsx)("td",{children:e.status}),(0,s.jsx)("td",{children:e.reason})]},e.id))})]})]})]})}}}]);
//# sourceMappingURL=16.614165cf.chunk.js.map