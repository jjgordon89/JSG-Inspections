"use strict";(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[454,596,740,934],{1596:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(5043),i=n(579);const s=function(e){let{equipmentId:t}=e;const[n,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>{t&&window.api.documents.getByEquipmentId(t).then(e=>{window.api.isError(e)?(console.error("Failed to load documents:",window.api.getErrorMessage(e)),s([])):s(e.data||[])})},[t]),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{children:"Documents"}),(0,i.jsx)("ul",{children:n.map(e=>(0,i.jsx)("li",{children:(0,i.jsx)("button",{onClick:()=>(async e=>{try{const t=await window.api.openFilePath(e);window.api.isError(t)&&(console.error("Failed to open document:",window.api.getErrorMessage(t)),alert(`Failed to open document: ${window.api.getErrorMessage(t)}`))}catch(t){console.error("Error opening document:",t),alert("Failed to open document. Please check if the file exists.")}})(e.file_path),className:"text-blue-600 hover:text-blue-800 underline bg-transparent border-none cursor-pointer",children:e.file_name})},e.id))})]})};var r=n(3953);const o=function(e){let{equipment:t,onEdit:n,onDelete:a,onViewInspections:o,onInspect:l}=e;return(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsxs)("h5",{className:"card-title",children:[t.equipment_id," - ",t.type]}),(0,i.jsxs)("p",{className:"card-text",children:[(0,i.jsx)("strong",{children:"Manufacturer:"})," ",t.manufacturer]}),(0,i.jsxs)("p",{className:"card-text",children:[(0,i.jsx)("strong",{children:"Model:"})," ",t.model]}),(0,i.jsxs)("p",{className:"card-text",children:[(0,i.jsx)("strong",{children:"Serial Number:"})," ",t.serial_number]}),(0,i.jsxs)("p",{className:"card-text",children:[(0,i.jsx)("strong",{children:"Status:"})," ",(0,i.jsx)("span",{className:`status status-${t.status.toLowerCase().replace(/ /g,"-")}`,children:t.status})]}),(0,i.jsx)(s,{equipmentId:t.id}),(0,i.jsxs)("div",{className:"card-buttons",children:[(0,i.jsx)("button",{onClick:()=>l(t),className:"btn-primary",children:"Inspect"}),(0,i.jsx)("button",{onClick:()=>o(t.id),className:"btn-outline",children:"View History"}),(0,i.jsx)("button",{onClick:()=>n(t),className:"btn-secondary",children:"Edit"}),(0,i.jsx)("button",{onClick:()=>(0,r.EJ)(t),className:"btn-secondary",children:"PDF"}),(0,i.jsx)("button",{onClick:()=>{window.confirm(`Are you sure you want to delete ${t.manufacturer} ${t.model}?`)&&a(t.id)},className:"btn-danger",children:"Delete"})]})]})})};var l=n(6454),c=n(7690);const d=function(e){let{onViewInspections:t,showToast:n}=e;const[s,r]=(0,a.useState)([]),[d,u]=(0,a.useState)(1),[m]=(0,a.useState)(5),[p,h]=(0,a.useState)(!1),[x,v]=(0,a.useState)(!0),[j,g]=(0,a.useState)(null),f=async()=>{try{v(!0),g(null);const e=await window.api.secure.equipment.getAll();if(!Array.isArray(e))throw new Error("Invalid equipment data received");r(e)}catch(j){console.error("Failed to fetch equipment:",j),g(j.message||"Failed to load equipment"),n&&n("Failed to load equipment")}finally{v(!1)}},w=(0,c.r9)(e=>e.refresh),y=(0,c.r9)(e=>e.searchTerm),q=(0,c.r9)(e=>e.setSearchTerm),b=(0,c.r9)(e=>e.setEditingEquipment),N=(0,c.r9)(e=>e.setInspectingEquipment);(0,a.useEffect)(()=>{f()},[w]);const C=async e=>{try{await window.api.equipment.delete(e),f(),n&&n("Equipment deleted")}catch(j){console.error("Failed to delete equipment:",j),n&&n("Failed to delete equipment")}},E=d*m,S=E-m,I=s.filter(e=>(e.manufacturer||"").toLowerCase().includes(y.toLowerCase())||(e.model||"").toLowerCase().includes(y.toLowerCase())),D=I.slice(S,E);return x?(0,i.jsxs)("section",{className:"equipment-list-section",children:[(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by manufacturer or model...",value:y,onChange:e=>{q(e.target.value),u(1)},className:"equipment-search-input","aria-label":"Search equipment",disabled:!0}),(0,i.jsx)("button",{className:"scan-button",disabled:!0,children:"Scan Equipment QR"})]}),(0,i.jsx)("div",{className:"equipment-card-grid",children:(0,i.jsx)("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:"2rem"},children:(0,i.jsx)("div",{className:"loading-spinner",children:"Loading equipment..."})})})]}):j?(0,i.jsxs)("section",{className:"equipment-list-section",children:[(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by manufacturer or model...",value:y,onChange:e=>{q(e.target.value),u(1)},className:"equipment-search-input","aria-label":"Search equipment",disabled:!0}),(0,i.jsx)("button",{className:"scan-button",disabled:!0,children:"Scan Equipment QR"})]}),(0,i.jsx)("div",{className:"equipment-card-grid",children:(0,i.jsx)("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:"2rem"},children:(0,i.jsxs)("div",{className:"error-message",children:[(0,i.jsxs)("p",{children:["Error loading equipment: ",j]}),(0,i.jsx)("button",{onClick:f,className:"retry-button",children:"Retry"})]})})})]}):(0,i.jsxs)("section",{className:"equipment-list-section",children:[(0,i.jsxs)("div",{className:"toolbar",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search by manufacturer or model...",value:y,onChange:e=>{q(e.target.value),u(1)},className:"equipment-search-input","aria-label":"Search equipment"}),(0,i.jsx)("button",{onClick:()=>h(!0),className:"scan-button",children:"Scan Equipment QR"})]}),(0,i.jsx)("div",{className:"equipment-card-grid",children:0===D.length?(0,i.jsx)("div",{style:{gridColumn:"1/-1",textAlign:"center",color:"#888"},children:0===I.length&&s.length>0?"No equipment matches your search criteria.":"No equipment found."}):D.map(e=>(0,i.jsx)(o,{equipment:e,onEdit:b,onDelete:C,onViewInspections:t,onInspect:N},e.id))}),(0,i.jsx)("div",{className:"pagination",children:Array.from({length:Math.ceil(I.length/m)},(e,t)=>(0,i.jsx)("button",{onClick:()=>u(t+1),className:d===t+1?"active":"","aria-current":d===t+1?"page":void 0,children:t+1},t+1))}),p&&(0,i.jsx)(l.default,{onScan:async e=>{if(e)try{const t=await window.api.equipment.getByEquipmentId(e);t?N(t):alert("Equipment not found")}catch(j){console.error("Failed to find equipment:",j),alert("Error searching for equipment")}h(!1)},onClose:()=>h(!1)})]})}},1841:()=>{},3553:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(5043),i=(n(1841),n(8970));function s(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{maxRetries:n=3,baseDelay:a=1e3,maxDelay:i=1e4,shouldRetry:s=e=>{var t;return!0===(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.retryable)}}=t;let r;for(let d=0;d<=n;d++)try{var o,l;const t=await e();if(null!==(o=window.api)&&void 0!==o&&o.isError(t)&&!s(t))return t;if(null===(l=window.api)||void 0===l||!l.isError(t))return t;if(r=t,d===n)break;const c=Math.min(a*Math.pow(2,d),i);console.log(`Retrying operation in ${c}ms (attempt ${d+1}/${n+1})`),await new Promise(e=>setTimeout(e,c))}catch(c){if(r=c,d===n||!s(c))break;const e=Math.min(a*Math.pow(2,d),i);console.log(`Retrying operation in ${e}ms (attempt ${d+1}/${n+1})`),await new Promise(t=>setTimeout(t,e))}return r}(e,{maxRetries:3,baseDelay:500,maxDelay:5e3,shouldRetry:e=>{var t;if(null!==(t=window.api)&&void 0!==t&&t.isError(e)){var n,a;const t=null===(n=e.error)||void 0===n?void 0:n.code;return["SQLITE_BUSY","SQLITE_LOCKED","NETWORK_ERROR","TIMEOUT"].includes(t)||!0===(null===(a=e.error)||void 0===a?void 0:a.retryable)}return!1},...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}})}async function r(e,t){try{var n;const t=await e();if((null===(n=window.api)||void 0===n||!n.isError(t))&&t.data)return console.log("Operation already completed, skipping write"),t}catch(a){console.log("Check operation failed, proceeding with write:",a)}return await t()}var o=n(8221),l=n(579);const c={equipmentId:"",type:"Overhead Crane",manufacturer:"",model:"",serialNumber:"",capacity:"",installationDate:"",location:"",status:"active",files:[],qrCodeData:""};const d=function(e){let{onEquipmentAdded:t}=e;const[n,d]=(0,a.useState)(c),u=(0,o.A)(e=>e.showToast),m=e=>{const{name:t,value:n}=e.target;d(e=>({...e,[t]:n}))};return(0,l.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const a=await async function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{successMessage:i,retryable:r=!1,onSuccess:o,onError:l}=a;try{var c;let a;if(a=r?await s(e):await e(),null!==(c=window.api)&&void 0!==c&&c.isError(a)){const e=window.api.getErrorMessage(a);return console.error(`${n} failed:`,a.error),t&&t(`${n} failed: ${e}`,"error"),l&&l(a),a}return i&&t&&t(i,"success"),o&&o(a),a}catch(d){throw console.error(`${n} failed with exception:`,d),t&&t(`${n} failed: ${d.message}`,"error"),l&&l(d),d}}(async()=>{const{files:e,...t}=n,a=(await window.api.equipment.create({equipmentId:t.equipmentId,type:t.type,manufacturer:t.manufacturer,model:t.model,serialNumber:t.serialNumber,capacity:t.capacity,installationDate:t.installationDate,location:t.location,status:t.status,qrCodeData:t.qrCodeData})).lastID,i=[];for(const n of e){const e=async()=>await window.api.documents.checkExisting(a,n.name),t=async()=>await window.api.documents.create({equipmentId:a,fileName:n.name,filePath:n.path||n.name,hash:"placeholder",size:n.size||0}),s=await r(e,t);i.push(s)}return{success:!0,data:{equipmentId:a,documentsAdded:i.length}}},u,"Add Equipment",{successMessage:`Equipment "${n.equipmentId}" added successfully`,onSuccess:()=>{t(),d(c)},onError:e=>{var n;null!==(n=e.error)&&void 0!==n&&n.partialSuccess&&(t(),d(c))}});return a},className:"add-equipment-form",children:[(0,l.jsx)("h3",{children:"Add New Equipment"}),(0,l.jsxs)("div",{className:"form-grid",children:[(0,l.jsx)("input",{name:"equipmentId",value:n.equipmentId,onChange:m,placeholder:"Equipment ID",required:!0}),(0,l.jsxs)("select",{name:"type",value:n.type,onChange:m,children:[(0,l.jsx)("option",{children:"Overhead Crane"}),(0,l.jsx)("option",{children:"Gantry Crane"}),(0,l.jsx)("option",{children:"Jib"}),(0,l.jsx)("option",{children:"Monorail"}),(0,l.jsx)("option",{children:"Hoist"})]}),(0,l.jsx)("input",{name:"manufacturer",value:n.manufacturer,onChange:m,placeholder:"Manufacturer"}),(0,l.jsx)("input",{name:"model",value:n.model,onChange:m,placeholder:"Model"}),(0,l.jsx)("input",{name:"serialNumber",value:n.serialNumber,onChange:m,placeholder:"Serial Number"}),(0,l.jsx)("input",{name:"capacity",type:"number",value:n.capacity,onChange:m,placeholder:"Capacity"}),(0,l.jsx)("input",{name:"installationDate",type:"date",value:n.installationDate,onChange:m}),(0,l.jsx)("input",{name:"location",value:n.location,onChange:m,placeholder:"Location"}),(0,l.jsxs)("select",{name:"status",value:n.status,onChange:m,children:[(0,l.jsx)("option",{value:"active",children:"Active"}),(0,l.jsx)("option",{value:"out of service",children:"Out of Service"}),(0,l.jsx)("option",{value:"under maintenance",children:"Under Maintenance"})]}),(0,l.jsx)("input",{type:"file",multiple:!0,onChange:e=>{d(t=>({...t,files:e.target.files}))},className:"form-full-width"}),(0,l.jsxs)("div",{className:"form-buttons",children:[(0,l.jsx)("button",{type:"button",onClick:async()=>{if(!n.equipmentId)return void alert("Please enter an Equipment ID first.");const e=await(async e=>{try{return await i.toDataURL(e,{errorCorrectionLevel:"H",type:"image/jpeg",quality:.3,margin:1,color:{dark:"#010599FF",light:"#FFBF60FF"}})}catch(t){return console.error(t),null}})(n.equipmentId);d(t=>({...t,qrCodeData:e}))},className:"btn-secondary",children:"Associate QR/NFC Tag"}),(0,l.jsx)("button",{type:"submit",className:"btn-submit",children:"Add Equipment"})]}),n.qrCodeData&&(0,l.jsx)("div",{className:"qr-code-container",children:(0,l.jsx)("img",{src:n.qrCodeData,alt:"QR Code"})})]})]})}},5740:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(5043),i=n(3553),s=n(1596),r=n(7690),o=n(579);const l=function(e){let{onViewInspections:t,showToast:n}=e;const[l,c]=(0,a.useState)(!1),d=(0,r.r9)(e=>e.searchTerm),u=(0,r.r9)(e=>e.setSearchTerm),m=(0,r.r9)(e=>e.filterStatus),p=(0,r.r9)(e=>e.setFilterStatus);return(0,o.jsxs)("div",{className:"equipment-container","data-testid":"equipment-container",children:[(0,o.jsxs)("div",{className:"equipment-header",children:[(0,o.jsx)("h2",{children:"Equipment Management"}),(0,o.jsxs)("div",{className:"equipment-controls",children:[(0,o.jsx)("input",{type:"text",placeholder:"Search equipment...",value:d,onChange:e=>u(e.target.value),className:"search-input"}),(0,o.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"filter-select","aria-label":"Filter by status",children:[(0,o.jsx)("option",{value:"all",children:"All Status"}),(0,o.jsx)("option",{value:"active",children:"Active"}),(0,o.jsx)("option",{value:"inactive",children:"Inactive"}),(0,o.jsx)("option",{value:"under maintenance",children:"Under Maintenance"})]}),(0,o.jsx)("button",{onClick:()=>c(!l),className:"btn-primary",children:l?"Cancel":"Add Equipment"})]})]}),l&&(0,o.jsx)("div",{className:"add-equipment-section",children:(0,o.jsx)(i.default,{onEquipmentAdded:()=>{c(!1),n&&n("Equipment added successfully!","success")},showToast:n})}),(0,o.jsx)(s.default,{onViewInspections:t,showToast:n,searchTerm:d,filterStatus:m})]})}},6454:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var a=n(5043),i=n(6048),s=n(4157),r=n(579);const o=e=>{let{onScan:t,onClose:n}=e;const[o,l]=(0,a.useState)("No result");return(0,r.jsx)(s.A,{onClose:n,children:(0,r.jsxs)("div",{className:"qr-scanner-container",children:[(0,r.jsx)(i.f,{onResult:(e,a)=>{e&&(l(null===e||void 0===e?void 0:e.text),t(null===e||void 0===e?void 0:e.text),n()),a&&console.info(a)},constraints:{facingMode:"environment"},style:{width:"100%"}}),(0,r.jsx)("p",{children:o})]})})}}}]);
//# sourceMappingURL=740.5bb93406.chunk.js.map