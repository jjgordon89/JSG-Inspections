"use strict";(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[454,596],{1596:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var s=n(5043),a=n(579);const i=function(e){let{equipmentId:t}=e;const[n,i]=(0,s.useState)([]);return(0,s.useEffect)(()=>{t&&window.api.documents.getByEquipmentId(t).then(e=>{window.api.isError(e)?(console.error("Failed to load documents:",window.api.getErrorMessage(e)),i([])):i(e.data||[])})},[t]),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"Documents"}),(0,a.jsx)("ul",{children:n.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>(async e=>{try{const t=await window.api.openFilePath(e);window.api.isError(t)&&(console.error("Failed to open document:",window.api.getErrorMessage(t)),alert(`Failed to open document: ${window.api.getErrorMessage(t)}`))}catch(t){console.error("Error opening document:",t),alert("Failed to open document. Please check if the file exists.")}})(e.file_path),className:"text-blue-600 hover:text-blue-800 underline bg-transparent border-none cursor-pointer",children:e.file_name})},e.id))})]})};var r=n(3953);const l=function(e){let{equipment:t,onEdit:n,onDelete:s,onViewInspections:l,onInspect:c}=e;return(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsxs)("h5",{className:"card-title",children:[t.equipment_id," - ",t.type]}),(0,a.jsxs)("p",{className:"card-text",children:[(0,a.jsx)("strong",{children:"Manufacturer:"})," ",t.manufacturer]}),(0,a.jsxs)("p",{className:"card-text",children:[(0,a.jsx)("strong",{children:"Model:"})," ",t.model]}),(0,a.jsxs)("p",{className:"card-text",children:[(0,a.jsx)("strong",{children:"Serial Number:"})," ",t.serial_number]}),(0,a.jsxs)("p",{className:"card-text",children:[(0,a.jsx)("strong",{children:"Status:"})," ",(0,a.jsx)("span",{className:`status status-${t.status.toLowerCase().replace(/ /g,"-")}`,children:t.status})]}),(0,a.jsx)(i,{equipmentId:t.id}),(0,a.jsxs)("div",{className:"card-buttons",children:[(0,a.jsx)("button",{onClick:()=>c(t),className:"btn-primary",children:"Inspect"}),(0,a.jsx)("button",{onClick:()=>l(t.id),className:"btn-outline",children:"View History"}),(0,a.jsx)("button",{onClick:()=>n(t),className:"btn-secondary",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>(0,r.EJ)(t),className:"btn-secondary",children:"PDF"}),(0,a.jsx)("button",{onClick:()=>{window.confirm(`Are you sure you want to delete ${t.manufacturer} ${t.model}?`)&&s(t.id)},className:"btn-danger",children:"Delete"})]})]})})};var c=n(6454),o=n(7690);const d=function(e){let{onViewInspections:t,showToast:n}=e;const[i,r]=(0,s.useState)([]),[d,u]=(0,s.useState)(1),[m]=(0,s.useState)(5),[p,h]=(0,s.useState)(!1),[x,j]=(0,s.useState)(!0),[g,b]=(0,s.useState)(null),q=async()=>{try{j(!0),b(null);const e=await window.api.secure.equipment.getAll();if(!Array.isArray(e))throw new Error("Invalid equipment data received");r(e)}catch(g){console.error("Failed to fetch equipment:",g),b(g.message||"Failed to load equipment"),n&&n("Failed to load equipment")}finally{j(!1)}},w=(0,o.r9)(e=>e.refresh),N=(0,o.r9)(e=>e.searchTerm),f=(0,o.r9)(e=>e.setSearchTerm),v=(0,o.r9)(e=>e.setEditingEquipment),y=(0,o.r9)(e=>e.setInspectingEquipment);(0,s.useEffect)(()=>{q()},[w]);const C=async e=>{try{await window.api.equipment.delete(e),q(),n&&n("Equipment deleted")}catch(g){console.error("Failed to delete equipment:",g),n&&n("Failed to delete equipment")}},E=d*m,S=E-m,k=i.filter(e=>(e.manufacturer||"").toLowerCase().includes(N.toLowerCase())||(e.model||"").toLowerCase().includes(N.toLowerCase())),F=k.slice(S,E);return x?(0,a.jsxs)("section",{className:"equipment-list-section",children:[(0,a.jsxs)("div",{className:"toolbar",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by manufacturer or model...",value:N,onChange:e=>{f(e.target.value),u(1)},className:"equipment-search-input","aria-label":"Search equipment",disabled:!0}),(0,a.jsx)("button",{className:"scan-button",disabled:!0,children:"Scan Equipment QR"})]}),(0,a.jsx)("div",{className:"equipment-card-grid",children:(0,a.jsx)("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:"2rem"},children:(0,a.jsx)("div",{className:"loading-spinner",children:"Loading equipment..."})})})]}):g?(0,a.jsxs)("section",{className:"equipment-list-section",children:[(0,a.jsxs)("div",{className:"toolbar",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by manufacturer or model...",value:N,onChange:e=>{f(e.target.value),u(1)},className:"equipment-search-input","aria-label":"Search equipment",disabled:!0}),(0,a.jsx)("button",{className:"scan-button",disabled:!0,children:"Scan Equipment QR"})]}),(0,a.jsx)("div",{className:"equipment-card-grid",children:(0,a.jsx)("div",{style:{gridColumn:"1/-1",textAlign:"center",padding:"2rem"},children:(0,a.jsxs)("div",{className:"error-message",children:[(0,a.jsxs)("p",{children:["Error loading equipment: ",g]}),(0,a.jsx)("button",{onClick:q,className:"retry-button",children:"Retry"})]})})})]}):(0,a.jsxs)("section",{className:"equipment-list-section",children:[(0,a.jsxs)("div",{className:"toolbar",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search by manufacturer or model...",value:N,onChange:e=>{f(e.target.value),u(1)},className:"equipment-search-input","aria-label":"Search equipment"}),(0,a.jsx)("button",{onClick:()=>h(!0),className:"scan-button",children:"Scan Equipment QR"})]}),(0,a.jsx)("div",{className:"equipment-card-grid",children:0===F.length?(0,a.jsx)("div",{style:{gridColumn:"1/-1",textAlign:"center",color:"#888"},children:0===k.length&&i.length>0?"No equipment matches your search criteria.":"No equipment found."}):F.map(e=>(0,a.jsx)(l,{equipment:e,onEdit:v,onDelete:C,onViewInspections:t,onInspect:y},e.id))}),(0,a.jsx)("div",{className:"pagination",children:Array.from({length:Math.ceil(k.length/m)},(e,t)=>(0,a.jsx)("button",{onClick:()=>u(t+1),className:d===t+1?"active":"","aria-current":d===t+1?"page":void 0,children:t+1},t+1))}),p&&(0,a.jsx)(c.default,{onScan:async e=>{if(e)try{const t=await window.api.equipment.getByEquipmentId(e);t?y(t):alert("Equipment not found")}catch(g){console.error("Failed to find equipment:",g),alert("Error searching for equipment")}h(!1)},onClose:()=>h(!1)})]})}},6454:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var s=n(5043),a=n(6048),i=n(4157),r=n(579);const l=e=>{let{onScan:t,onClose:n}=e;const[l,c]=(0,s.useState)("No result");return(0,r.jsx)(i.A,{onClose:n,children:(0,r.jsxs)("div",{className:"qr-scanner-container",children:[(0,r.jsx)(a.f,{onResult:(e,s)=>{e&&(c(null===e||void 0===e?void 0:e.text),t(null===e||void 0===e?void 0:e.text),n()),s&&console.info(s)},constraints:{facingMode:"environment"},style:{width:"100%"}}),(0,r.jsx)("p",{children:l})]})})}}}]);
//# sourceMappingURL=596.a99f049e.chunk.js.map