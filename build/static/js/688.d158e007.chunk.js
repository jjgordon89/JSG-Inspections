"use strict";(self.webpackChunkjsg_inspections=self.webpackChunkjsg_inspections||[]).push([[688],{4688:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var a=n(5043),s=n(2877),o=n(579);const r=function(e){let{photo:t,onSave:n,onCancel:r,enableBatchMode:c=!1,batchPhotos:l=[]}=e;const i=(0,a.useRef)(null),d=(0,a.useRef)(null),[h,u]=(0,a.useState)("#FF0000"),[m,g]=(0,a.useState)(.8),[b,v]=(0,a.useState)(0),[x,j]=(0,a.useState)({}),[p,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(i.current&&!p){const e=new s.eF(i.current,{targetRoot:document.body,markerTypes:[s.yA,s.MX,s.nY]});t.annotations&&t.annotations.length>0&&e.restoreState(t.annotations),e.addEventListener("render",e=>{const a={...t,dataUrl:e.dataUrl,annotations:e.state};n(a)}),e.addEventListener("close",()=>{r&&r()}),f(!0),e.show(),d.current=e}return()=>{d.current&&(d.current.close(),d.current=null,f(!1))}},[t,n,r,p]);const C=()=>{d.current&&d.current.close(),r&&r()},w=c&&l.length>0?l[b]:t,N="string"===typeof w?w:null===w||void 0===w?void 0:w.dataUrl;return(0,o.jsxs)("div",{className:"photo-annotation-container",children:[(0,o.jsxs)("div",{className:"annotation-toolbar",children:[(0,o.jsxs)("div",{className:"toolbar-section",children:[(0,o.jsx)("label",{children:"Annotation Color:"}),(0,o.jsx)("input",{type:"color",value:h,onChange:e=>{return t=e.target.value,u(t),void(d.current&&d.current.setMarkerColor(t));var t}})]}),(0,o.jsxs)("div",{className:"toolbar-section",children:[(0,o.jsx)("label",{children:"Compression Quality:"}),(0,o.jsx)("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:m,onChange:e=>g(parseFloat(e.target.value))}),(0,o.jsxs)("span",{children:[Math.round(100*m),"%"]}),(0,o.jsx)("button",{onClick:async()=>{const e="string"===typeof t?t:t.dataUrl;if(e)try{const t=await fetch(e),a=await t.blob(),s=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1920,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1080;return new Promise(s=>{const o=document.createElement("canvas"),r=o.getContext("2d"),c=new Image;c.onload=()=>{let{width:e,height:l}=c;if(e>n||l>a){const t=Math.min(n/e,a/l);e*=t,l*=t}o.width=e,o.height=l,r.drawImage(c,0,0,e,l),o.toBlob(s,"image/jpeg",t)},c.src=URL.createObjectURL(e)})}(a,m),o=new FileReader;o.onload=()=>{const e=o.result;n&&n({dataUrl:e,compressed:!0,originalSize:a.size,compressedSize:s.size,compressionRatio:(1-s.size/a.size).toFixed(2)})},o.readAsDataURL(s)}catch(a){console.error("Compression failed:",a)}},className:"compress-btn",children:"Compress Photo"})]}),c&&l.length>0&&(0,o.jsxs)("div",{className:"toolbar-section batch-controls",children:[(0,o.jsxs)("span",{children:["Photo ",b+1," of ",l.length]}),(0,o.jsx)("button",{onClick:()=>{b>0&&v(e=>e-1)},disabled:0===b,className:"nav-btn",children:"Previous"}),(0,o.jsx)("button",{onClick:()=>{b<l.length-1&&v(e=>e+1)},disabled:b===l.length-1,className:"nav-btn",children:"Next"})]}),(0,o.jsx)("div",{className:"annotation-actions",children:c?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:async()=>{if(c&&l.length>0){const e=l[b];if(d.current&&e){const e=await new Promise(e=>{d.current.addEventListener("render",t=>{e({dataUrl:t.dataUrl,annotations:d.current.getState()})},{once:!0}),d.current.render()});j(t=>({...t,[b]:e})),b<l.length-1?v(e=>e+1):n&&n(x)}}},className:"save-btn",children:b===l.length-1?"Finish Batch":"Save & Next"}),(0,o.jsx)("button",{onClick:C,className:"cancel-btn",children:"Cancel Batch"})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:async()=>{d.current&&d.current.render()},className:"save-btn",children:"Save Annotations"}),(0,o.jsx)("button",{onClick:C,className:"cancel-btn",children:"Cancel"})]})})]}),(0,o.jsx)("img",{ref:i,src:N,alt:"For annotation",style:{maxWidth:"100%",maxHeight:"70vh"}})]})}}}]);
//# sourceMappingURL=688.d158e007.chunk.js.map